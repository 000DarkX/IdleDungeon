!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).SimpleQuad={})}(this,(function(t){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function e(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(t){if("string"==typeof t)return r(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var u=0,o=function(){};return{s:o,n:function(){return u>=t.length?{done:!0}:{done:!1,value:t[u++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,f=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){f=!0,i=t},f:function(){try{a||null==e.return||e.return()}finally{if(f)throw i}}}}function u(t){return void 0!==t.r}function o(t){return void 0!==t.width}function i(t){return!u(t)&&!o(t)}function a(t){return{x:t.x,y:t.y,r:0}}function f(t){return{x:t.x,y:t.y,width:0,height:0}}function c(t,n){return{x:n.x-t.x,y:n.y-t.y}}function y(t){var n=d(t);return{x:n>0?t.x/n:0,y:n>0?t.y/n:0}}function h(t,n){return t.x*n.x+t.y*n.y}function s(t,n){return{x:t.x*n,y:t.y*n}}function d(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=t.x*t.x+t.y*t.y;return n&&1!==r?Math.sqrt(r):r}function x(t){return"string"!=typeof t._key&&(t._key="(".concat(t.x,",").concat(t.y,")")),t._key}function l(t,n){var r=n.x+n.width,e=n.y+n.height;return t.x>=n.x&&t.x<=r&&t.y>=n.y&&t.y<=e}var v=[{x:0,y:-1},{x:1,y:0}];function m(t,n){var r=u(t),e=u(n),c=o(t),y=o(n),h=i(t),s=i(n);return r&&e?p(t,n,!1):c&&y?g(t,n,!1):h&&s?p(a(t),a(n),!1):r&&y?b(n,t,!0):c&&e?b(t,n,!1):r&&s?p(t,a(n),!1):h&&e?p(a(t),n,!1):c&&s?g(t,f(n),!1):g(f(t),n,!1)}function p(t,n,r){if(!function(t,n){var r=t.x-n.x,e=t.y-n.y,u=r*r+e*e,o=t.r+n.r;return u<=o*o}(t,n))return null;var e=w(t),u=w(n),o=y(c(t,n));return e.axes.push(o),I(e,u,r)}function b(t,n,r){if(!function(t,n){var r=n.x-Math.max(t.x,Math.min(n.x,t.x+t.width)),e=n.y-Math.max(t.y,Math.min(n.y,t.y+t.height));return r*r+e*e<=n.r*n.r}(t,n))return null;var e,u,o,i,a,f=N(t),h=w(n),s=(e=n,u=f.points,i=u[0],a=Number.POSITIVE_INFINITY,u.forEach((function(t){(o=d(c(e,t),!1))<a&&(a=o,i=t)})),{closestPoint:i}).closestPoint;if(s.x!==n.x||s.y!==n.y){var x=y(c(n,s));h.axes.push(x)}return I(f,h,r)}function g(t,n,r){if(!function(t,n){return t.x<=n.x+n.width&&t.x+t.width>=n.x&&t.y<=n.y+n.height&&t.y+t.height>=n.y}(t,n))return null;var e=N(t),u=N(n);return u.axes=[],I(e,u,r)}function I(t,r,e){for(var u,o,i,a,f,y=t.axes.concat(r.axes),d=Number.POSITIVE_INFINITY,x=null,l=y.length,v=t.buffer,m=r.buffer,p=function(n){var e=y[n];if(o=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY,t.points.forEach((function(t){u=h(t,e),i=Math.min(u-v,i),o=Math.max(u+v,o)})),r.points.forEach((function(t){u=h(t,e),f=Math.min(u-m,f),a=Math.max(u+m,a)})),o<f||a<i)return{v:null};var c=Math.max(i,f),s=Math.min(o,a)-c;s<d&&(d=s,x=e)},b=0;b<l;b++){var g=p(b);if("object"===n(g))return g.v}if(!x)return null;var I=c(t.center,r.center),w=h(x,I)>0;return(!w&&!e||w&&e)&&(x=s(x,-1)),{vector:s(x,d),direction:x,magnitude:d}}function w(t){return{axes:[],points:[{x:t.x,y:t.y}],center:{x:t.x,y:t.y},buffer:t.r}}function N(t){var n,r,e,u,o,i=(r=(n=t).x,e=n.y,u=r+n.width,o=e+n.height,[{x:r,y:e},{x:u,y:e},{x:u,y:o},{x:r,y:o}]);return{axes:[].concat(v),points:i,center:{x:t.x+t.width/2,y:t.y+t.height/2},buffer:0}}function E(t,n){if(!l({x:n.x,y:n.y},t.bounds))return!1;if((t.quadrants||[]).length)return t.quadrants.some((function(t){return E(t,n)}));var r=x(n),e=t.data.get(r)||new Set;if(e.has(n))return!1;if(e.size>0||t.data.size+1<=t.capacity)return e.add(n),t.data.set(r,e),!0;var u,o,i,a,f,c=(u=t.bounds,o=u.width/2,i=u.height/2,a=u.x+o,f=u.y+i,[{x:u.x,y:u.y,width:o,height:i},{x:a,y:u.y,width:o,height:i},{x:u.x,y:f,width:o,height:i},{x:a,y:f,width:o,height:i}]).map((function(n){return q(n,t.capacity)})),y=_(t);return y.push(n),T(t),t.quadrants=c,y.every((function(n){return E(t,n)}))}function S(t,n){var r={x:n.x,y:n.y},e=x(n),u=t.data.get(e)||new Set;if(!l(r,t.bounds))return!1;if(u.has(n))return u.delete(n),u.size>0?t.data.set(e,u):t.data.delete(e),!0;var o=t.quadrants.some((function(t){return S(t,n)}));if(o){var i=M(t,t.bounds);i.length<=t.capacity&&(T(t),i.forEach((function(n){return E(t,n.object)})))}return o}function T(t){t.data.clear(),t.quadrants.length=0}function M(t,n){if(!m(t.bounds,n))return[];if(0===(t.quadrants||[]).length){var r=[];return _(t).forEach((function(t){var e=m(t,n);e&&t!==n&&r.push({mtv:e,object:t})})),r}var e=[];return t.quadrants.forEach((function(t){M(t,n).forEach((function(t){return e.push(t)}))})),e}function _(t){var n,r=[],u=e(t.data.values());try{for(u.s();!(n=u.n()).done;){n.value.forEach((function(t){return r.push(t)}))}}catch(t){u.e(t)}finally{u.f()}return r}function q(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r={bounds:t,data:new Map,capacity:n,quadrants:[],add:function(t){return E(r,t)},remove:function(t){return S(r,t)},clear:function(){return T(r)},query:function(t){return M(r,t)},getData:function(){return _(r)}};return r}t.createQuadTree=q,Object.defineProperty(t,"__esModule",{value:!0})}));
